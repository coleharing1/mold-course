"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},3573:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>x,patchFetch:()=>I,requestAsyncStorage:()=>_,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var t={};s.r(t),s.d(t,{POST:()=>m});var i=s(49303),o=s(88716),a=s(60670),n=s(87070),u=s(75571),c=s(89403),p=s(13910),l=s(5018),d=s(62343);async function m(e){try{let r;let s=await (0,u.getServerSession)(l.L);if(!s?.user?.email)return n.NextResponse.json({error:"You must be logged in to purchase"},{status:401});let{priceId:t,planType:i,billingPeriod:o}=await e.json();if(![p.K.priceIds.core.oneTime,p.K.priceIds.core.discounted,p.K.priceIds.plus.monthly,p.K.priceIds.plus.annual,p.K.priceIds.vip.oneTime].includes(t))return n.NextResponse.json({error:"Invalid price selection"},{status:400});let a=await d._.user.findUnique({where:{email:s.user.email},include:{purchases:!0}});if(!a)return n.NextResponse.json({error:"User not found"},{status:404});let m=a.purchases.find(e=>e.stripeCustomerId);r=m?.stripeCustomerId?await c.A.customers.retrieve(m.stripeCustomerId):await c.A.customers.create({email:s.user.email,metadata:{userId:a.id}});let h="http://localhost:3000",_=`${h}/checkout/success?session_id={CHECKOUT_SESSION_ID}`,y=`${h}/checkout/cancelled`,v={customer:r.id,payment_method_types:["card"],line_items:[{price:t,quantity:1}],mode:"plus"===i?"subscription":"payment",success_url:_,cancel_url:y,metadata:{userId:a.id,planType:i,billingPeriod:o||"one-time"}};"plus"===i&&(v.subscription_data={metadata:{userId:a.id}}),("core"===i||"vip"===i)&&(v.payment_intent_data={metadata:{userId:a.id,planType:i}});let x=await c.A.checkout.sessions.create(v);return await d._.purchase.create({data:{userId:a.id,sku:`${i}-${o||"onetime"}`,amount:"core"===i?"annual"===o?p.K.prices.core.discounted:p.K.prices.core.oneTime:"plus"===i?"annual"===o?12*p.K.prices.plus.annual:p.K.prices.plus.monthly:p.K.prices.vip.oneTime,currency:"usd",status:"pending",stripeCustomerId:r.id}}),n.NextResponse.json({sessionId:x.id,url:x.url})}catch(e){return console.error("Checkout error:",e),n.NextResponse.json({error:"Failed to create checkout session"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"/Users/coleharing/Cursor_Projects/Mold_detox_2/app/api/checkout/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:_,staticGenerationAsyncStorage:y,serverHooks:v}=h,x="/api/checkout/route";function I(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},5018:(e,r,s)=>{s.d(r,{L:()=>n});var t=s(53797),i=s(84050),o=s(62343),a=s(42023);let n={adapter:(0,i.N)(o._),session:{strategy:"jwt"},pages:{signIn:"/signin",signOut:"/signin",error:"/signin",verifyRequest:"/signin"},providers:[(0,t.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Invalid credentials");let r=await o._.user.findUnique({where:{email:e.email}});if(!r||!r.password||!await a.ZP.compare(e.password,r.password))throw Error("Invalid credentials");return{id:r.id,email:r.email,name:r.name}}})],callbacks:{jwt:async({token:e,user:r})=>r?{...e,id:r.id}:e,session:async({session:e,token:r})=>({...e,user:{...e.user,id:r.id}})}}},62343:(e,r,s)=>{s.d(r,{_:()=>i});let t=require("@prisma/client"),i=globalThis.prisma??new t.PrismaClient},89403:(e,r,s)=>{s.d(r,{A:()=>o});var t=s(62903),i=s(13910);let o=new t.Z(i.K.secretKey,{apiVersion:"2025-07-30.basil",typescript:!0})},13910:(e,r,s)=>{s.d(r,{K:()=>t});let t={publishableKey:"pk_test_YOUR_TEST_KEY",secretKey:process.env.STRIPE_SECRET_KEY,webhookSecret:process.env.STRIPE_WEBHOOK_SECRET,prices:{core:{oneTime:19900,discounted:14900},plus:{monthly:5900,annual:4700},vip:{oneTime:99700}},priceIds:{core:{oneTime:process.env.STRIPE_PRICE_CORE_ONETIME||"",discounted:process.env.STRIPE_PRICE_CORE_DISCOUNTED||""},plus:{monthly:process.env.STRIPE_PRICE_PLUS_MONTHLY||"",annual:process.env.STRIPE_PRICE_PLUS_ANNUAL||""},vip:{oneTime:process.env.STRIPE_PRICE_VIP_ONETIME||""}},products:{core:{name:"Mold Detox Mastery - Core",description:"Complete mold recovery program with all 10 modules and 9 interactive tools",features:["All 10 educational modules","9 interactive recovery tools","Downloadable resources & PDFs","Progress tracking dashboard","Mobile app access","1 year of content updates","Email support (48hr response)"]},plus:{name:"Mold Detox Mastery - Plus",description:"Core + community support & advanced features",features:["Everything in Core","Community forum access","Monthly live Q&A sessions","Advanced practitioner tools","Priority email support (24hr)","Lifetime content updates","20% consultation discount"]},vip:{name:"Mold Detox Mastery - VIP",description:"Premium package with 1-on-1 support",features:["Everything in Plus","3 x 1-on-1 consultations","Personalized protocol review","Direct messaging access","Custom supplement recommendations","Priority support"]}}}}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[276,972,23,687,903],()=>s(3573));module.exports=t})();